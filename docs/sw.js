const CACHE_NAME="story-app-v2",STATIC_CACHE="story-app-static-v2",API_CACHE="story-app-api-v2",staticAssets=["/","/index.html","/manifest.json","/styles.css","/src/main.js","/src/router.js","/src/presenters/pagePresenter.js","/src/models/apiModel.js","/src/models/dataModel.js","/src/db/favorite-db.js","/scripts/pwa-init.js","/src/views/homeView.js","/src/views/aboutView.js","/src/views/contactView.js","/src/views/mapView.js","/src/views/addstoryView.js","/src/views/favoritesView.js","/src/views/login-page.js","/src/views/register-page.js","/icons/icon-192x192.png","/icons/icon-512x512.png","https://unpkg.com/leaflet@1.9.4/dist/leaflet.css","https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"];self.addEventListener("install",s=>{s.waitUntil(Promise.all([caches.open(STATIC_CACHE).then(s=>s.addAll(staticAssets)),caches.open(API_CACHE).then(()=>console.log("API cache created"))])),self.skipWaiting()}),self.addEventListener("activate",s=>{s.waitUntil(caches.keys().then(s=>Promise.all(s.filter(s=>!s.includes("v2")).map(s=>caches.delete(s))))),self.clients.claim()}),self.addEventListener("fetch",s=>{const e=new URL(s.request.url);e.pathname.startsWith("/api")||("https://story-api.dicoding.dev"===e.origin?s.respondWith(fetch(s.request).then(e=>{if(e&&200===e.status){const t=e.clone();caches.open(API_CACHE).then(e=>e.put(s.request,t))}return e}).catch(()=>caches.match(s.request))):s.respondWith(caches.match(s.request).then(e=>e||fetch(s.request).then(e=>{if(e&&200===e.status&&"basic"===e.type){const t=e.clone();caches.open(STATIC_CACHE).then(e=>e.put(s.request,t))}return e}))))}),self.addEventListener("push",s=>{let e={};s.data&&(e=s.data.json());const t=e.title||"Cerita Baru!",i={body:e.message||"Cek cerita terbaru di aplikasi!",icon:e.icon||"/icons/icon-192x192.png",data:{url:e.url||"/#/add-story"},actions:[{action:"view",title:"View Story"},{action:"dismiss",title:"Dismiss"}]};s.waitUntil(self.registration.showNotification(t,i))}),self.addEventListener("notificationclick",s=>{if(s.notification.close(),"view"===s.action){const e=s.notification.data.url;s.waitUntil(clients.openWindow(e))}else"dismiss"===s.action&&console.log("Notification dismissed")});