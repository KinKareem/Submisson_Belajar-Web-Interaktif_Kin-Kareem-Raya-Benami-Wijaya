const CACHE_NAME="story-app-v2",STATIC_CACHE="story-app-static-v2",API_CACHE="story-app-api-v2",staticAssets=["/","/index.html","/manifest.json","/styles.css","/src/main.js","/src/router.js","/src/presenters/pagePresenter.js","/src/models/apiModel.js","/src/models/dataModel.js","/src/db/favorite-db.js","/scripts/pwa-init.js","/src/views/homeView.js","/src/views/aboutView.js","/src/views/contactView.js","/src/views/mapView.js","/src/views/addstoryView.js","/src/views/favoritesView.js","/src/views/login-page.js","/src/views/register-page.js","/icons/icon-192x192.png","/icons/icon-512x512.png","https://unpkg.com/leaflet@1.9.4/dist/leaflet.css","https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"];self.addEventListener("install",e=>{e.waitUntil(Promise.all([caches.open(STATIC_CACHE).then(e=>e.addAll(staticAssets)),caches.open(API_CACHE).then(()=>console.log("API cache created"))])),self.skipWaiting()}),self.addEventListener("activate",e=>{e.waitUntil(caches.keys().then(e=>Promise.all(e.filter(e=>!e.includes("v2")).map(e=>caches.delete(e))))),self.clients.claim()}),self.addEventListener("fetch",e=>{"https://story-api.dicoding.dev"===new URL(e.request.url).origin?e.respondWith(fetch(e.request).then(s=>{if(s&&200===s.status){const t=s.clone();caches.open(API_CACHE).then(s=>s.put(e.request,t))}return s}).catch(()=>caches.match(e.request))):e.respondWith(caches.match(e.request).then(s=>s||fetch(e.request).then(s=>{if(s&&200===s.status&&"basic"===s.type){const t=s.clone();caches.open(STATIC_CACHE).then(s=>s.put(e.request,t))}return s})))}),self.addEventListener("push",e=>{let s={};e.data&&(s=e.data.json());const t=s.title||"Cerita Baru!",i={body:s.message||"Cek cerita terbaru di aplikasi!",icon:s.icon||"/icons/icon-192x192.png",data:{url:s.url||"/#/add-story"},actions:[{action:"view",title:"View Story"},{action:"dismiss",title:"Dismiss"}]};e.waitUntil(self.registration.showNotification(t,i))}),self.addEventListener("notificationclick",e=>{if(e.notification.close(),"view"===e.action){const s=e.notification.data.url;e.waitUntil(clients.openWindow(s))}else"dismiss"===e.action&&console.log("Notification dismissed")});